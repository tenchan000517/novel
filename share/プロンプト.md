
æ–°ã—ã„çµ±åˆè¨˜æ†¶éšå±¤ã‚·ã‚¹ãƒ†ãƒ ã«å¯¾å¿œã™ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å®Œå…¨ã«æœ€é©åŒ–ã—ã¦ãã ã•ã„ã€‚



## ğŸ“š å¿…é ˆç†è§£äº‹é …

### çµ±åˆè¨˜æ†¶éšå±¤ã‚·ã‚¹ãƒ†ãƒ ã®å®Œå…¨ç†è§£
ä»¥ä¸‹ã®å…±æœ‰ä»•æ§˜æ›¸ã¨ã‚³ãƒ¼ãƒ‰ã‚’**å®Œå…¨ã«ç†è§£**ã—ã¦ã‹ã‚‰å®Ÿè£…ã—ã¦ãã ã•ã„ï¼š

1. **è¨˜æ†¶éšå±¤ã‚·ã‚¹ãƒ†ãƒ ä»•æ§˜æ›¸ï¼ˆå®Ÿè£…ç‰ˆï¼‰** - ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®æ§‹æˆã¨å‹å®šç¾©
2. **è¨˜æ†¶éšå±¤ã‚·ã‚¹ãƒ†ãƒ å®Œå…¨ç§»è¡Œä»•æ§˜æ›¸** - ç§»è¡Œãƒ‘ã‚¿ãƒ¼ãƒ³ã¨APIå¤‰æ›´è©³ç´°  
3. **MemoryManagerï¼ˆmemory-manager.tsï¼‰** - ä¸­æ ¸ç®¡ç†ã‚¯ãƒ©ã‚¹ã®å®Ÿè£…
4. **types.ts** - çµ±ä¸€å‹å®šç¾©ã¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
5. **interfaces.ts** - çµ±ä¸€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ä»•æ§˜
6. **å„è¨˜æ†¶å±¤å®Ÿè£…** - ShortTermMemory, MidTermMemory, LongTermMemory
7. **çµ±åˆã‚·ã‚¹ãƒ†ãƒ ** - UnifiedAccessAPI, CacheCoordinator, DuplicateResolverç­‰

### æ—¢å­˜ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å®Œå…¨æŠŠæ¡
- ç¾åœ¨ã®å®Ÿè£…ã«ãŠã‘ã‚‹å…¨ã¦ã®æ©Ÿèƒ½ã¨è²¬ä»»ã‚’æŠŠæ¡
- æ—¢å­˜ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯APIã¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Œå…¨ç†è§£
- ä¾å­˜é–¢ä¿‚ã¨å¤–éƒ¨ã¨ã®é€£æºæ–¹æ³•ã‚’è©³ç´°æŠŠæ¡
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã®ç†è§£

## ğŸš¨ çµ¶å¯¾ç¦æ­¢äº‹é …ï¼ˆé‡è¦ï¼‰

### 1. æ†¶æ¸¬ãƒ»äºˆæ¸¬ã«ã‚ˆã‚‹å®Ÿè£…ã®å®Œå…¨ç¦æ­¢
```typescript
// âŒ æ†¶æ¸¬ã§ã®å®Ÿè£…ä¾‹
// ãŸã¶ã‚“ã“ã†ã ã‚ã†ã¨ã„ã†å®Ÿè£…
async someMethod() {
  // å¤šåˆ†ã“ã‚“ãªæ„Ÿã˜ã§å‹•ãã¯ãš...
  return await this.memoryManager.getData(); // â† æ†¶æ¸¬
}

// âœ… ä»•æ§˜æ›¸ã«åŸºã¥ãæ­£ç¢ºãªå®Ÿè£…
async someMethod() {
  // ä»•æ§˜æ›¸ã«æ˜è¨˜ã•ã‚ŒãŸunifiedSearchã‚’ä½¿ç”¨
  const result = await this.memoryManager.unifiedSearch(query, levels);
  return this.processSearchResult(result);
}
```

### 2. å‹å®šç¾©ç„¡è¦–ã®ç‹¬è‡ªå®Ÿè£…ã®å®Œå…¨ç¦æ­¢
```typescript
// âŒ å‹å®šç¾©ã‚’ç„¡è¦–ã—ãŸå‹æ‰‹ãªå®Ÿè£…
interface CustomResult {
  data: any; // â† types.tsã®å®šç¾©ã‚’ç„¡è¦–
}

// âœ… types.tsã§å®šç¾©ã•ã‚ŒãŸå‹ã®å®Œå…¨æº–æ‹ 
import { UnifiedMemoryContext, MemoryAccessRequest } from '../core/types';
const context: UnifiedMemoryContext = {
  // types.tsã®å®šç¾©ã«å®Œå…¨æº–æ‹ ã—ãŸå®Ÿè£…
};
```

### 3. æœªå®Œæˆéƒ¨åˆ†ã‚’æ®‹ã™ã“ã¨ã®å®Œå…¨ç¦æ­¢
```typescript
// âŒ æœªå®Œæˆãªå®Ÿè£…
async processData() {
  // TODO: å¾Œã§å®Ÿè£…ã™ã‚‹
  throw new Error('Not implemented yet');
}

// âŒ ä¸­é€”åŠç«¯ãªã‚³ãƒ¡ãƒ³ãƒˆ
// å®Ÿéš›ã®å®Ÿè£…ã§ã¯é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒå¿…è¦...

// âœ… å®Œå…¨ã«å®Ÿè£…ã•ã‚ŒãŸæ©Ÿèƒ½
async processData() {
  try {
    const result = await this.executeFullLogic();
    return this.validateAndReturn(result);
  } catch (error) {
    this.handleSpecificError(error);
    throw new ProcessingError(`Data processing failed: ${error.message}`);
  }
}
```

### 4. æ—¢å­˜æ©Ÿèƒ½ã®æ¬ æãƒ»åŠ£åŒ–ã®å®Œå…¨ç¦æ­¢
```typescript
// âŒ æ—¢å­˜æ©Ÿèƒ½ã‚’å‰Šé™¤ãƒ»ç°¡ç•¥åŒ–
async generateCharacter() {
  return { id: 'temp', name: 'temp' }; // â† æ©Ÿèƒ½åŠ£åŒ–
}

// âœ… æ—¢å­˜æ©Ÿèƒ½ã‚’å®Œå…¨ä¿æŒãƒ»å¼·åŒ–
async generateCharacter() {
  // æ—¢å­˜ã®å…¨æ©Ÿèƒ½ã‚’ä¿æŒã—ã¤ã¤æ–°ã‚·ã‚¹ãƒ†ãƒ å¯¾å¿œ
  const character = await this.createFullCharacter();
  const enhancedCharacter = await this.enhanceWithUnifiedMemory(character);
  return this.validateCompleteness(enhancedCharacter);
}
```

## ğŸ”§ å®Œå…¨å®Ÿè£…è¦ä»¶

### 1. ä¾å­˜æ³¨å…¥ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å®Œå…¨å®Ÿè£…
```typescript
export class ComponentName {
  constructor(
    private memoryManager: MemoryManager,  // â† å¿…é ˆä¾å­˜æ³¨å…¥
    private dependencies: RequiredDependencies,
    config?: Partial<ComponentConfig>
  ) {
    // è¨­å®šã®å®Œå…¨æ¤œè¨¼ã¨åˆæœŸåŒ–
    this.validateConfiguration(config);
    this.config = this.mergeWithDefaults(config);
    this.initializeInternalState();
  }

  private validateConfiguration(config?: Partial<ComponentConfig>): void {
    if (!this.memoryManager) {
      throw new Error('MemoryManager is required for component initialization');
    }
    // è¨­å®šã®å®Œå…¨æ¤œè¨¼
  }
}
```

### 2. å‹å®‰å…¨æ€§ã®å®Œå…¨ç¢ºä¿
```typescript
// å…¨ã¦ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚¢ã‚¯ã‚»ã‚¹ã‚’å®‰å…¨ã«å®Ÿè£…
private ensureSafePropertyAccess<T>(
  obj: T | undefined,
  initializer: () => T
): T {
  if (!obj) {
    return initializer();
  }
  return obj;
}

// ä½¿ç”¨ä¾‹
const personality = this.ensureSafePropertyAccess(
  character.personality,
  () => ({ traits: [], values: [], quirks: [], speechPatterns: [] })
);
```

### 3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®å®Œå…¨å®Ÿè£…
```typescript
async mainOperation(): Promise<ResultType> {
  const operationContext = this.createOperationContext();
  
  try {
    // æ®µéšçš„ãªå‡¦ç†ã¨æ¤œè¨¼
    const step1Result = await this.executeStep1(operationContext);
    this.validateStep1Result(step1Result);
    
    const step2Result = await this.executeStep2(step1Result, operationContext);
    this.validateStep2Result(step2Result);
    
    const finalResult = await this.finalizePprocess(step2Result);
    this.validateFinalResult(finalResult);
    
    return finalResult;
    
  } catch (error) {
    return this.handleOperationError(error, operationContext);
  }
}

private handleOperationError(error: unknown, context: OperationContext): never {
  const errorDetails = this.analyzeError(error);
  this.logOperationFailure(errorDetails, context);
  
  // æ®µéšçš„ãªã‚¨ãƒ©ãƒ¼å›å¾©ã‚’è©¦è¡Œ
  if (this.canRecover(errorDetails)) {
    return this.attemptRecovery(errorDetails, context);
  }
  
  // é©åˆ‡ãªã‚¨ãƒ©ãƒ¼å‹ã§å†ã‚¹ãƒ­ãƒ¼
  throw new ComponentOperationError(
    `Operation failed: ${errorDetails.message}`,
    errorDetails.code,
    errorDetails.recoverable
  );
}
```

### 4. çµ±åˆè¨˜æ†¶ã‚·ã‚¹ãƒ†ãƒ ã®å®Œå…¨æ´»ç”¨
```typescript
private async getComprehensiveMemoryContext(
  params: OperationParams
): Promise<ComprehensiveMemoryContext> {
  try {
    // è¤‡æ•°ã®æ¤œç´¢æˆ¦ç•¥ã‚’çµ„ã¿åˆã‚ã›ãŸå®Œå…¨ãªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå–å¾—
    const [
      unifiedSearchResult,
      systemStatus,
      diagnostics
    ] = await Promise.allSettled([
      this.memoryManager.unifiedSearch(
        this.buildOptimizedSearchQuery(params),
        [MemoryLevel.LONG_TERM, MemoryLevel.MID_TERM, MemoryLevel.SHORT_TERM]
      ),
      this.memoryManager.getSystemStatus(),
      this.memoryManager.performSystemDiagnostics()
    ]);

    return this.buildComprehensiveContext(
      unifiedSearchResult,
      systemStatus,
      diagnostics,
      params
    );
    
  } catch (error) {
    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æˆ¦ç•¥ã®å®Œå…¨å®Ÿè£…
    return this.buildFallbackContext(params, error);
  }
}
```

## ğŸ“Š å®Œå…¨å“è³ªä¿è¨¼è¦ä»¶

### ã‚³ãƒ¼ãƒ‰ã®å®Œå…¨æ€§ãƒã‚§ãƒƒã‚¯
```typescript
// å…¨ã¦ã®ãƒ¡ã‚½ãƒƒãƒ‰ã«å®Œå…¨ãªå®Ÿè£…
// å…¨ã¦ã®ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã«å¯¾å¿œ
// å…¨ã¦ã®å‹å®šç¾©ã«æº–æ‹ 
// å…¨ã¦ã®æ—¢å­˜æ©Ÿèƒ½ã‚’ä¿æŒãƒ»å¼·åŒ–
```

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å®Œå…¨æœ€é©åŒ–
```typescript
private performanceMetrics = {
  operationCount: 0,
  totalProcessingTime: 0,
  memoryAccessTime: 0,
  cacheHitRate: 0,
  errorRate: 0
};

private async executeWithPerformanceTracking<T>(
  operation: () => Promise<T>,
  operationName: string
): Promise<T> {
  const startTime = performance.now();
  const memoryBefore = this.getCurrentMemoryUsage();
  
  try {
    const result = await operation();
    this.recordSuccessfulOperation(startTime, memoryBefore, operationName);
    return result;
  } catch (error) {
    this.recordFailedOperation(startTime, error, operationName);
    throw error;
  }
}
```

## âœ… å®Œå…¨æ€§æ¤œè¨¼ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### å®Ÿè£…å®Œå…¨æ€§
- [ ] å…¨ã¦ã®æ—¢å­˜æ©Ÿèƒ½ãŒå®Œå…¨ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] æ–°ã—ã„è¨˜æ†¶éšå±¤ã‚·ã‚¹ãƒ†ãƒ ã®æ©Ÿèƒ½ã‚’æœ€å¤§é™æ´»ç”¨
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒå…¨ã‚±ãƒ¼ã‚¹ã«å¯¾å¿œ
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹

### å‹å®‰å…¨æ€§
- [ ] TypeScriptå‹ã‚¨ãƒ©ãƒ¼ãŒä¸€åˆ‡ãªã„
- [ ] å…¨ã¦ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚¢ã‚¯ã‚»ã‚¹ãŒå®‰å…¨
- [ ] types.tsã®å®šç¾©ã«å®Œå…¨æº–æ‹ 
- [ ] ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã¨ã®å®Œå…¨äº’æ›æ€§

### ã‚·ã‚¹ãƒ†ãƒ çµ±åˆ
- [ ] MemoryManagerã®ä¾å­˜æ³¨å…¥ãŒæ­£ã—ãå®Ÿè£…
- [ ] ãƒ‘ãƒ–ãƒªãƒƒã‚¯APIã®ã¿ã‚’ä½¿ç”¨
- [ ] çµ±åˆè¨˜æ†¶ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Œå…¨æ´»ç”¨
- [ ] é©åˆ‡ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†

### å“è³ªä¿è¨¼
- [ ] ESLintã‚¨ãƒ©ãƒ¼ãƒ»è­¦å‘Šã‚¼ãƒ­
- [ ] å®Œå…¨ãªJSDocè¨˜è¿°
- [ ] é©åˆ‡ãªãƒ­ã‚°å‡ºåŠ›ã¨ã‚¨ãƒ©ãƒ¼è¿½è·¡
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ã®å®Ÿè£…

## ğŸ¯ å®Œå…¨å®Ÿè£…ã®ç¢ºèªäº‹é …

### å…±æœ‰ã‚³ãƒ¼ãƒ‰ã®ç†è§£ç¢ºèª
- MemoryManagerã®å…¨ã¦ã®ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç†è§£ã—é©åˆ‡ã«ä½¿ç”¨
- types.tsã§å®šç¾©ã•ã‚ŒãŸå…¨ã¦ã®å‹ã‚’æ­£ç¢ºã«ä½¿ç”¨
- çµ±åˆè¨˜æ†¶ã‚·ã‚¹ãƒ†ãƒ ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã‚’å®Œå…¨ç†è§£
- æ—¢å­˜ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å…¨æ©Ÿèƒ½ã¨è²¬ä»»ã‚’æŠŠæ¡

### å®Ÿè£…ã®å®Œå…¨æ€§ç¢ºèª
- æ†¶æ¸¬ã‚„äºˆæ¸¬ã«ã‚ˆã‚‹å®Ÿè£…ãŒä¸€åˆ‡ãªã„
- å…¨ã¦ã®æ©Ÿèƒ½ãŒå®Œå…¨ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- æœªå®Œæˆãªéƒ¨åˆ†ã‚„"TODO"ãŒä¸€åˆ‡ãªã„
- æ—¢å­˜æ©Ÿèƒ½ã®æ¬ æã‚„åŠ£åŒ–ãŒä¸€åˆ‡ãªã„

### å“è³ªã®ç¢ºèª
- å‹å®‰å…¨æ€§ãŒå®Œå…¨ã«ç¢ºä¿ã•ã‚Œã¦ã„ã‚‹
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒç¶²ç¾…çš„ã«å®Ÿè£…
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒæœ€é©åŒ–ã•ã‚Œã¦ã„ã‚‹
- ä¿å®ˆæ€§ã¨æ‹¡å¼µæ€§ãŒç¢ºä¿ã•ã‚Œã¦ã„ã‚‹

**å¿…ãšä¸Šè¨˜ã®å…¨ã¦ã®è¦ä»¶ã‚’æº€ãŸã—ã€æ†¶æ¸¬ã‚„ä¸­é€”åŠç«¯ãªå®Ÿè£…ã¯ä¸€åˆ‡è¡Œã‚ãšã€å…±æœ‰ã•ã‚ŒãŸä»•æ§˜æ›¸ã¨ã‚³ãƒ¼ãƒ‰ã‚’å®Œå…¨ã«ç†è§£ã—ãŸä¸Šã§ã€æ—¢å­˜ã®æ©Ÿèƒ½ã‚’ä¸€åˆ‡æ¬ æã•ã›ã‚‹ã“ã¨ãªãæ–°ã—ã„è¨˜æ†¶éšå±¤ã‚·ã‚¹ãƒ†ãƒ ã®èƒ½åŠ›ã‚’æœ€å¤§é™æ´»ç”¨ã—ãŸå®Œç’§ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ä»•ä¸Šã’ã¦ãã ã•ã„ã€‚**
```

---
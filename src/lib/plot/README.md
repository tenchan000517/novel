# プロットマネージャーシステム ドキュメント

## 目次
1. [システム概要](#システム概要)
2. [設定ファイル仕様](#設定ファイル仕様)
   - [世界設定 (world-settings.yaml)](#世界設定-world-settingsyaml)
   - [テーマ設定 (theme-tracker.yaml)](#テーマ設定-theme-trackeryaml)
   - [抽象プロット (abstract-plot.yaml)](#抽象プロット-abstract-plotyaml)
   - [具体プロット (concrete-plot.yaml)](#具体プロット-concrete-plotyaml)
   - [プロット戦略 (plot-strategy.yaml)](#プロット戦略-plot-strategyyaml)
3. [物語フェーズと構造](#物語フェーズと構造)
4. [高度な機能](#高度な機能)
   - [テーマ共鳴分析](#テーマ共鳴分析)
   - [シーン構造最適化](#シーン構造最適化)
   - [文学的インスピレーション](#文学的インスピレーション)
5. [ベストプラクティス](#ベストプラクティス)
6. [トラブルシューティング](#トラブルシューティング)

## システム概要

プロットマネージャーシステムは、AI小説生成のための物語構造を管理するコアコンポーネントです。このシステムは「抽象プロット」と「具体プロット」の2層構造を採用し、物語の一貫性を保ちながら創造的な展開を可能にします。

**主要機能：**
- 抽象・具体の2層プロット管理
- 物語フェーズの追跡と管理
- プロット整合性のチェック
- テーマの一貫性と共鳴分析
- シーン構造の最適化推奨
- 文学的インスピレーションの提供

**システムの利点：**
- 物語の大枠を維持しながら創造的な自由度を許容
- テーマの一貫した表現と発展
- 物語構造のバランス最適化
- 文学的質の向上

## 設定ファイル仕様

プロットマネージャーは以下の設定ファイルを使用します。すべてYAML形式で、`config`ディレクトリに配置します。

### 世界設定 (world-settings.yaml)

物語世界の基本設定を定義します。AIはこれに基づいて一貫した世界観で物語を生成します。

```yaml
genre: business  # ジャンルは必須
description: |
  2020年代の日本。テクノロジーの進化と従来の企業文化が混在する過渡期のスタートアップ環境。
  ポストコロナ期でリモートワークが普及し、若い世代の価値観と従来の就職概念が変化している。
regions:
  - name: 東京スタートアップシーン
    description: 渋谷、六本木を中心に投資家やインキュベーション施設が点在するエリア。
  - name: 大学キャンパス
    description: 学生起業家コミュニティが形成されている場所。
businessSystem:
  description: 日本の企業文化と新興のスタートアップ思想が混在する環境。
  rules:
    - 伝統的な企業は年功序列・終身雇用の価値観が根強い
    - スタートアップは成果主義・フラットな組織構造を志向する傾向
technology:
  description: AIやクラウドサービスが発展する一方、多くの企業ではレガシーシステムも健在。
socialSystem:
  description: 大企業志向の安定層と起業志向の挑戦層の二極化が進み、キャリア観が多様化。
uniqueElements:
  - name: 根回し
    description: 意思決定前に関係者に事前に説明を行い同意を得る日本型ビジネスプロセス。
  - name: 名刺交換
    description: ビジネスコミュニケーションの起点となる日本独自の文化。
```

### テーマ設定 (theme-tracker.yaml)

物語を通じて探求するテーマを定義します。AIはこれに基づいてテーマを一貫して表現します。

```yaml
description: |
  本作品は「運命と自由意志の相克」を中心テーマとし、登場人物たちが予言された運命に抗いながら、
  自らの道を切り開こうとする姿を描く。
mainThemes:
  - 運命と自由意志
  - 権力と責任
  - 過去との和解
subThemes:
  - 家族の絆
  - 正義と道徳的曖昧さ
  - 異文化間の理解
  - 成長と自己発見
evolution:
  - phase: OPENING
    focus: 運命に縛られた主人公
    description: 予言に翻弄される主人公の姿を描く
  - phase: MIDDLE
    focus: 運命への抵抗
    description: 主人公が予言に抗い始める
  - phase: CLIMAX
    focus: 自由意志の獲得
    description: 主人公が予言を覆す決断をする
  - phase: ENDING
    focus: 新たな運命の創造
    description: 主人公自身が新たな未来を築く
implementation:
  symbolism:
    - symbol: 鳥籠
      meaning: 運命による束縛
    - symbol: 折れた鎖
      meaning: 運命からの解放
  conflicts:
    - 予言者 vs 主人公
    - 伝統的価値観 vs 革新的思想
message: |
  運命は固定されたものではなく、自らの意志と行動によって変えることができる。
  しかし、完全な自由もまた幻想であり、すべての選択には代償が伴う。
```

### 抽象プロット (abstract-plot.yaml)

物語の大枠となる抽象的な方向性やテーマ展開を定義します。章の範囲ごとに設定できます。

```yaml
- phase: "OPENING" # 物語フェーズ
  theme: "運命との対峙" # この範囲のテーマ
  emotionalTone: "不安と期待の混在" # 感情的トーン
  chapterRange: [1, 5] # 適用する章の範囲
  thematicMessage: "定められた運命に疑問を持ち始める" # 伝えたいメッセージ
  phasePurpose: "主人公と世界観の紹介、および中心的な葛藤の確立" # このフェーズの目的
  potentialDirections: # 可能な方向性
    - "主人公が予言について知る"
    - "最初の冒険への呼び出し"
    - "初めての能力の発現"
    - "運命の予言者との邂逅"
  prohibitedElements: # 避けるべき要素
    - "主人公の力の完全な解放"
    - "核心的な謎の早期解決"
    - "主要キャラクターの唐突な死"
  keyCharacters: # 焦点を当てるキャラクター
    - "アレン（主人公）"
    - "予言者マティアス"
    - "メンター役ガルド"

- phase: "EARLY"
  theme: "使命の受容と仲間との出会い"
  emotionalTone: "決意と友情"
  chapterRange: [6, 15]
  thematicMessage: "信頼できる仲間と共に運命に立ち向かう勇気"
  phasePurpose: "冒険の開始と同行者の集結"
  potentialDirections:
    - "冒険の旅立ち"
    - "仲間たちとの出会い"
    - "最初の試練の克服"
    - "運命の鍵となる古代遺物の発見"
  prohibitedElements:
    - "主要な敵との決定的対決"
    - "物語の中心的謎の解明"
    - "同行者間の修復不可能な対立"
  keyCharacters:
    - "アレン（主人公）"
    - "エリザ（魔法使い）"
    - "ダリオン（戦士）"
    - "予言者マティアス"

# 他のフェーズも同様に定義...

- phase: "CLIMAX"
  theme: "運命との最終対決"
  emotionalTone: "絶望から希望への転換"
  chapterRange: [36, 40]
  thematicMessage: "真の運命は自らの手で切り開くもの"
  phasePurpose: "主要な葛藤の解決と主人公の最終的変革"
  potentialDirections:
    - "最終決戦の場への到達"
    - "敵の真の正体と動機の明示"
    - "予言の真意の解明"
    - "主人公の最大の犠牲と選択"
  prohibitedElements:
    - "簡単な解決策"
    - "前触れのない救済"
    - "キャラクターの動機に矛盾する行動"
  keyCharacters:
    - "全主要キャラクター"
```

### 具体プロット (concrete-plot.yaml)

章範囲ごとに、具体的なイベントや要素を定義します。AIはこれを厳密に遵守します。

```yaml
- chapterRange: [1, 3] # 適用する章の範囲
  phase: "OPENING" # 物語フェーズ
  title: "予言の影" # プロットタイトル
  summary: "アレンは平凡な村の少年だったが、彼の16歳の誕生日に村を訪れた予言者マティアスにより、彼が古代の予言に記された「運命の子」であることが明かされる。信じられないアレンだが、直後に村が謎の集団に襲撃され、彼の中に眠る力が目覚める。" # 概要
  storyArc: "運命の子の目覚め" # ストーリーアーク
  storyGoal: "主人公の運命との最初の邂逅と冒険への呼び出し" # 物語目標
  keyEvents: # 重要イベント
    - "予言者マティアスが村に到着し、アレンが「運命の子」であると告げる"
    - "村への襲撃と両親の危機"
    - "アレンの中に眠る力の最初の発現"
    - "マティアスによる古代遺跡への旅の提案"
  characterFocus: # 注目キャラクター
    - "アレン（主人公）"
    - "予言者マティアス"
    - "アレンの両親"
  requiredElements: # 必須要素
    - "古代予言の断片的な説明"
    - "アレンの力の性質に関する最初のヒント"
    - "マティアスの謎めいた過去への言及"
    - "村の襲撃者の正体に関する手がかり"
  foreshadowing: # 伏線
    - "アレンの父親が隠し持っていた古代の書物"
    - "アレンの夢に現れる謎の声"
    - "マティアスの杖に刻まれた同じ印が村の古い石碑にも存在する"
  mustHaveOutcome: "アレンがマティアスと共に村を離れ、古代遺跡への旅に出る決意をする" # 必ず達成すべき結果

- chapterRange: [4, 5]
  phase: "EARLY"
  title: "古代遺跡の秘密"
  summary: "アレンとマティアスは古代遺跡を目指す旅を始める。途中、彼らは魔法使いのエリザと出会い、彼女も同じ予言に導かれていたことを知る。三人は共に遺跡に到達し、そこで予言の全容と、アレンが背負う使命の重大さを知る。"
  storyArc: "運命の子の目覚め"
  storyGoal: "予言の全容解明と最初の同行者との出会い"
  keyEvents:
    - "旅の途中でエリザとの出会い"
    - "エリザが同じ予言に導かれていたことの発覚"
    - "古代遺跡の到達と謎めいた石板の発見"
    - "石板からの啓示：世界を脅かす「影の王」の復活"
  characterFocus:
    - "アレン"
    - "マティアス"
    - "エリザ"
  requiredElements:
    - "エリザの魔法の才能と背景"
    - "遺跡内の古代文明の痕跡"
    - "予言の詳細な説明"
    - "影の王の歴史と脅威"
  foreshadowing:
    - "エリザのペンダントがアレンの力と共鳴する"
    - "遺跡の壁画に描かれた、未来の出来事の一部"

# 他の章範囲も同様に定義...

- chapterRange: [36, 40]
  phase: "CLIMAX"
  title: "運命の分岐点"
  summary: "アレンと仲間たちは影の王の城塞に到達し、最終決戦に挑む。予言の真意が明らかになり、アレンは自分の運命を自らの手で切り開く決断をする。大きな犠牲を伴いながらも、彼は影の王を封印し、新たな世界の幕開けをもたらす。"
  storyArc: "運命への反逆と新たな未来"
  storyGoal: "最終決戦と予言の超越"
  keyEvents:
    - "影の王の城塞への潜入"
    - "予言者マティアスの真の正体と目的の明示"
    - "真の敵との対決"
    - "アレンの究極の選択と犠牲"
    - "予言の超越と新たな未来の創造"
  characterFocus:
    - "全主要キャラクター"
  requiredElements:
    - "予言の本当の意味の解明"
    - "各キャラクターの内面的葛藤の解決"
    - "アレンの力の完全な開花"
    - "敵の動機と背景の完全な明示"
  mustHaveOutcome: "予言に縛られていたアレンが、自らの選択で新たな運命を切り開く"
```

### プロット戦略 (plot-strategy.yaml)

AIによるプロット解釈の方法と重みづけを制御します。

```yaml
globalStrategy:
  preferredMode: "mixed" # concrete, abstract, mixed のいずれか
  abstractRatio: 0.6 # 抽象プロットの重み（0-1）
  plotComplexity: "medium" # low, medium, high のいずれか
chapterModeOverrides: # 特定の章範囲でのモードオーバーライド
  - chapterRange: [1, 3]
    mode: "CONCRETE" # 厳密に具体プロットに従う
    reason: "物語の導入部分は正確に設定したい"
  - chapterRange: [20, 25]
    mode: "ABSTRACT" # 抽象プロットの方向性をより重視
    reason: "キャラクターの内面的な成長に焦点を当てるため"
  - chapterRange: [36, 40]
    mode: "CONCRETE" # クライマックスはしっかり制御
    reason: "物語のクライマックスを確実に計画通りに展開させる"
arcStrategies: # 特定のストーリーアークに対する戦略
  - arcName: "運命の子の目覚め"
    strategy: "キャラクターの内面の葛藤を重視"
    notes: "アレンの不信と受容のプロセスを丁寧に描写する"
  - arcName: "試練の旅路"
    strategy: "世界観の拡大と仲間の絆の強化"
    notes: "多様な土地と文化を通じて世界の深みを表現する"
  - arcName: "運命への反逆と新たな未来"
    strategy: "テーマの集大成と感情的なインパクト"
    notes: "すべての伏線を回収し、感動的な結末を目指す"
```

## 物語フェーズと構造

物語は以下のフェーズ構造に基づいて構築されます。各フェーズは特定の目的を持ち、プロットはこの構造に従って展開します。

### 標準的なフェーズ構造

1. **OPENING** (序章/オープニング)
   - 目的: 世界観とキャラクターの紹介、中心的な葛藤の提示
   - 典型的な長さ: 全体の10%程度
   - 重要度: 高 (読者の興味を引き付ける)

2. **EARLY** (序盤)
   - 目的: 冒険の開始、基本的な課題の提示、仲間との出会い
   - 典型的な長さ: 全体の20%程度
   - 重要度: 中〜高

3. **MIDDLE** (中盤)
   - 目的: 葛藤の複雑化、キャラクターの成長、伏線の配置
   - 典型的な長さ: 全体の40%程度
   - 重要度: 中

4. **LATE** (終盤)
   - 目的: クライマックスへの準備、緊張の高まり、伏線回収の開始
   - 典型的な長さ: 全体の20%程度
   - 重要度: 中〜高

5. **CLIMAX** (クライマックス)
   - 目的: 物語の最高潮、中心的な葛藤の解決、キャラクターの変革
   - 典型的な長さ: 全体の5-10%程度
   - 重要度: 非常に高

6. **ENDING** (終章/エンディング)
   - 目的: 解決後の世界の描写、キャラクターの変化の確認、全体的なテーマの集大成
   - 典型的な長さ: 全体の5-10%程度
   - 重要度: 高 (読者の印象に残る)

### フェーズ移行ポイント

各フェーズ間の移行は、物語の重要な転換点となります。移行ポイントでは、以下の点に注意してください：

- 前のフェーズから次のフェーズへの橋渡しを意識する
- 新たなフェーズのトーンや方向性を確立する
- キャラクターの新たな目標や課題を提示する

## 高度な機能

プロットマネージャーには、物語の質を高める高度な機能が組み込まれています。

### テーマ共鳴分析

テーマ共鳴分析システムは、生成された内容がどの程度テーマを表現しているかを分析し、改善提案を行います。

```yaml
# テーマ共鳴分析の例
themes:
  "運命と自由意志":
    explicitMentions: 
      - "「予言は不変のものではない。私たちが選ぶ道次第で変わる」とアレンは言った"
    implicitExpressions:
      - "分岐する道の前で、彼は長い間立ち尽くした"
    strength: 8
    expressionMethods: ["対話", "内面描写", "象徴"]
  "権力と責任":
    explicitMentions: []
    implicitExpressions: 
      - "王冠を見つめるアレンの瞳に、恐れと希望が交錯した"
    strength: 4
    expressionMethods: ["象徴", "行動"]
overallCoherence: 7
dominantTheme: "運命と自由意志"
```

この機能を活用するには：
- 各章にどのテーマを強調するか計画的に配分する
- 単調な表現を避け、様々な表現方法（対話、象徴、行動など）を組み合わせる
- 相互に関連するテーマの間に自然な流れを作る

### シーン構造最適化

シーン構造最適化システムは、物語のリズムとペースを分析し、最適なシーン構成を推奨します。

```yaml
# シーン構造分析の例
typeDistribution:
  INTRODUCTION: 2
  DEVELOPMENT: 5
  CLIMAX: 1
  RESOLUTION: 1
  TRANSITION: 1
lengthDistribution:
  min: 500
  max: 2500
  avg: 1200
  stdDev: 600
paceVariation: 0.6
```

効果的な使い方：
- 各章のシーンタイプのバランスを意識する（導入、展開、クライマックス、解決）
- シーンの長さにバリエーションをつけてリズム感を生み出す
- 緊張と緩和のサイクルを意識的に構築する

### 文学的インスピレーション

文学的インスピレーションシステムは、物語の現在地点と目標に合わせた文学的テクニックを提案します。

```yaml
# 文学的インスピレーションの例
plotTechniques:
  - technique: "伏線の配置と回収"
    description: "物語の序盤で示唆し、後半で意味を明かす技法"
    example: "主人公の夢に繰り返し現れる象徴的なイメージが、後に重要な意味を持つことが明らかになる"
    reference: "指輪物語"
characterTechniques:
  - technique: "内面と外面の対比"
    description: "キャラクターの内面的葛藤と外面的振る舞いのギャップを描く"
    example: "表面上は冷静な判断をしながらも、内面では激しい感情の嵐が渦巻いている様子"
    reference: "罪と罰"
atmosphereTechniques:
  - technique: "環境と感情の共鳴"
    description: "登場人物の感情を環境描写に投影する"
    example: "主人公の絶望を表現するための激しい嵐の描写"
    reference: "ワーザリング・ハイツ"
```

この機能を最大限に活用するには：
- 物語のフェーズに合わせた技法を選択する
- 複数のテクニックを自然に組み合わせる
- キャラクター、プロット、雰囲気のバランスを考える

## ベストプラクティス

プロットマネージャーの能力を最大限に発揮するためのベストプラクティスを紹介します。

### プロット設計のポイント

1. **階層構造を意識する**
   - 抽象プロット：大きな方向性、テーマ、感情的トーン
   - 具体プロット：特定のイベント、キャラクターの焦点、必須要素

2. **必須要素と自由度のバランス**
   - 必ず含めるべき要素は `keyEvents` と `requiredElements` に設定
   - 創造的な自由度が必要な部分は抽象的な記述にとどめる

3. **章範囲の適切な区切り**
   - 物語のフェーズごとに自然な区切りを設定
   - 一つの章範囲は5-10章程度が扱いやすい
   - フェーズ移行ポイントは特に注意深く設計する

4. **テーマの進化**
   - 物語を通じてテーマがどのように深まるか計画する
   - フェーズごとにテーマの異なる側面を探求する

5. **伏線の計画的配置**
   - 伏線の配置と回収のタイミングを意識する
   - `foreshadowing` 要素を適切に設定

### 効果的なプロット戦略

1. **物語フェーズに合わせたモード切替**
   - 序盤と終盤：具体プロット（CONCRETE）を重視し、明確な方向性を与える
   - 中盤：抽象プロット（ABSTRACT）の比重を上げ、創造的な発展を促す
   - 重要な転換点：具体プロット（CONCRETE）で確実に計画通りに展開させる

2. **抽象と具体のバランス調整**
   - キャラクターの内面探求シーン：抽象比率を上げる
   - アクションや重要イベント：具体比率を上げる
   - 普段は「mixed」モードで柔軟性を持たせる

3. **プロット複雑度の戦略的調整**
   - `plotComplexity` を物語のフェーズに応じて変化させる
   - 序盤：低〜中（basic story foundation）
   - 中盤：中〜高（complex developments）
   - 終盤：高（all threads coming together）

## トラブルシューティング

よくある問題と解決法を紹介します。

### プロット整合性の問題

**問題**: 生成された章が設定したプロットから逸脱している

**解決法**:
- 具体プロットの `keyEvents` と `requiredElements` の記述をより明確にする
- プロット戦略の `preferredMode` を "concrete" に変更する
- 特定の章範囲に対して `chapterModeOverrides` を設定する

### テーマ表現の弱さ

**問題**: 設定したテーマが物語で十分に表現されていない

**解決法**:
- `theme-tracker.yaml` のテーマ説明をより具体的に記述する
- 抽象プロットの `thematicMessage` をより明確に設定する
- 具体プロットの `requiredElements` にテーマに関連する要素を追加する

### キャラクター焦点のブレ

**問題**: 意図したキャラクターに十分な焦点が当たっていない

**解決法**:
- 具体プロットの `characterFocus` にキャラクターを明示的に追加する
- プロット戦略の `arcStrategies` でキャラクター焦点に関する注記を追加する
- 抽象プロットの `keyCharacters` を確認・調整する

### 物語構造のアンバランス

**問題**: 章が適切なペースで展開していない

**解決法**:
- フェーズ構造と章範囲の対応を見直す
- シーン構造最適化の推奨を参考にシーン構成を調整する
- プロット戦略で `plotComplexity` を調整する

---

**注意**: このプロットマネージャーシステムは物語の骨組みを提供するものです。AIの創造力と組み合わせることで、構造的な一貫性と創造的な自由のバランスの取れた物語を生成できます。システムのパラメータとファイル構成を調整することで、あなたの創作意図に最も適した物語生成が可能になります。
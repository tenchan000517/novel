<svg viewBox="0 0 800 600" xmlns="http://www.w3.org/2000/svg">
  <!-- 背景 -->
  <rect width="800" height="600" fill="#f8f9fa" />
  
  <!-- タイトル -->
  <text x="400" y="30" text-anchor="middle" font-family="Arial" font-size="20" font-weight="bold" fill="#333">AI小説生成システム - 設定ファイルとプロンプト反映フロー</text>
  
  <!-- 設定ファイル群 -->
  <rect x="50" y="70" width="150" height="180" rx="5" ry="5" fill="#e3f2fd" stroke="#2196f3" stroke-width="2" />
  <text x="125" y="90" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#1565c0">設定ファイル</text>
  <rect x="70" y="100" width="110" height="25" rx="3" ry="3" fill="#bbdefb" stroke="#64b5f6" stroke-width="1" />
  <text x="125" y="117" text-anchor="middle" font-family="Arial" font-size="12" fill="#0d47a1">キャラクター (YAML)</text>
  <rect x="70" y="135" width="110" height="25" rx="3" ry="3" fill="#bbdefb" stroke="#64b5f6" stroke-width="1" />
  <text x="125" y="152" text-anchor="middle" font-family="Arial" font-size="12" fill="#0d47a1">関係性 (YAML/JSON)</text>
  <rect x="70" y="170" width="110" height="25" rx="3" ry="3" fill="#bbdefb" stroke="#64b5f6" stroke-width="1" />
  <text x="125" y="187" text-anchor="middle" font-family="Arial" font-size="12" fill="#0d47a1">プロット (JSON)</text>
  <rect x="70" y="205" width="110" height="25" rx="3" ry="3" fill="#bbdefb" stroke="#64b5f6" stroke-width="1" />
  <text x="125" y="222" text-anchor="middle" font-family="Arial" font-size="12" fill="#0d47a1">世界設定</text>
  
  <!-- マネージャー群 -->
  <rect x="250" y="70" width="150" height="180" rx="5" ry="5" fill="#e8f5e9" stroke="#4caf50" stroke-width="2" />
  <text x="325" y="90" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#2e7d32">マネージャー</text>
  <rect x="270" y="100" width="110" height="25" rx="3" ry="3" fill="#c8e6c9" stroke="#81c784" stroke-width="1" />
  <text x="325" y="117" text-anchor="middle" font-family="Arial" font-size="12" fill="#1b5e20">CharacterManager</text>
  <rect x="270" y="135" width="110" height="25" rx="3" ry="3" fill="#c8e6c9" stroke="#81c784" stroke-width="1" />
  <text x="325" y="152" text-anchor="middle" font-family="Arial" font-size="12" fill="#1b5e20">PlotManager</text>
  <rect x="270" y="170" width="110" height="25" rx="3" ry="3" fill="#c8e6c9" stroke="#81c784" stroke-width="1" />
  <text x="325" y="187" text-anchor="middle" font-family="Arial" font-size="12" fill="#1b5e20">ForeshadowingManager</text>
  <rect x="270" y="205" width="110" height="25" rx="3" ry="3" fill="#c8e6c9" stroke="#81c784" stroke-width="1" />
  <text x="325" y="222" text-anchor="middle" font-family="Arial" font-size="12" fill="#1b5e20">MemoryManager</text>
  
  <!-- GenerationContext -->
  <rect x="450" y="70" width="150" height="180" rx="5" ry="5" fill="#fff3e0" stroke="#ff9800" stroke-width="2" />
  <text x="525" y="90" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#e65100">GenerationContext</text>
  <rect x="470" y="100" width="110" height="25" rx="3" ry="3" fill="#ffe0b2" stroke="#ffb74d" stroke-width="1" />
  <text x="525" y="117" text-anchor="middle" font-family="Arial" font-size="12" fill="#e65100">基本情報</text>
  <rect x="470" y="135" width="110" height="25" rx="3" ry="3" fill="#ffe0b2" stroke="#ffb74d" stroke-width="1" />
  <text x="525" y="152" text-anchor="middle" font-family="Arial" font-size="12" fill="#e65100">キャラクター情報</text>
  <rect x="470" y="170" width="110" height="25" rx="3" ry="3" fill="#ffe0b2" stroke="#ffb74d" stroke-width="1" />
  <text x="525" y="187" text-anchor="middle" font-family="Arial" font-size="12" fill="#e65100">プロット/伏線情報</text>
  <rect x="470" y="205" width="110" height="25" rx="3" ry="3" fill="#ffe0b2" stroke="#ffb74d" stroke-width="1" />
  <text x="525" y="222" text-anchor="middle" font-family="Arial" font-size="12" fill="#e65100">物語状態/テンション</text>
  
  <!-- プロンプトテンプレート -->
  <rect x="650" y="70" width="150" height="180" rx="5" ry="5" fill="#f3e5f5" stroke="#9c27b0" stroke-width="2" />
  <text x="725" y="90" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#6a1b9a">プロンプト生成</text>
  <rect x="670" y="100" width="110" height="25" rx="3" ry="3" fill="#e1bee7" stroke="#ba68c8" stroke-width="1" />
  <text x="725" y="117" text-anchor="middle" font-family="Arial" font-size="12" fill="#4a148c">EnhancedPromptTemplate</text>
  <rect x="670" y="135" width="110" height="25" rx="3" ry="3" fill="#e1bee7" stroke="#ba68c8" stroke-width="1" />
  <text x="725" y="152" text-anchor="middle" font-family="Arial" font-size="12" fill="#4a148c">プレースホルダー置換</text>
  <rect x="670" y="170" width="110" height="25" rx="3" ry="3" fill="#e1bee7" stroke="#ba68c8" stroke-width="1" />
  <text x="725" y="187" text-anchor="middle" font-family="Arial" font-size="12" fill="#4a148c">セクション追加</text>
  <rect x="670" y="205" width="110" height="25" rx="3" ry="3" fill="#e1bee7" stroke="#ba68c8" stroke-width="1" />
  <text x="725" y="222" text-anchor="middle" font-family="Arial" font-size="12" fill="#4a148c">最終プロンプト</text>
  
  <!-- 矢印 -->
  <path d="M 200 160 L 250 160" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)" />
  <path d="M 400 160 L 450 160" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)" />
  <path d="M 600 160 L 650 160" stroke="#333" stroke-width="2" fill="none" marker-end="url(#arrowhead)" />
  
  <!-- マーカー定義 -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
  </defs>
  
  <!-- プロンプト例 -->
  <rect x="50" y="280" width="700" height="300" rx="5" ry="5" fill="#fff" stroke="#ccc" stroke-width="2" />
  <text x="400" y="300" text-anchor="middle" font-family="Arial" font-size="14" font-weight="bold" fill="#333">生成プロンプト例</text>
  
  <text x="60" y="320" font-family="monospace" font-size="10" fill="#333"># 【小説生成指示】</text>
  <text x="60" y="335" font-family="monospace" font-size="10" fill="#333">## 基本情報</text>
  <text x="60" y="350" font-family="monospace" font-size="10" fill="#333">- 章番号: 5/50</text>
  <text x="60" y="365" font-family="monospace" font-size="10" fill="#333">- 目標文字数: 8000文字程度</text>
  <text x="60" y="380" font-family="monospace" font-size="10" fill="#333">- 語り口調: 三人称視点</text>
  
  <text x="60" y="395" font-family="monospace" font-size="10" fill="#333">## 登場人物</text>
  <text x="60" y="410" font-family="monospace" font-size="10" fill="#333">【山田太郎】</text>
  <text x="60" y="425" font-family="monospace" font-size="10" fill="#333">特徴: 17歳の高校生で特殊能力の持ち主</text>
  <text x="60" y="440" font-family="monospace" font-size="10" fill="#333">役割: 主要人物</text>
  
  <text x="60" y="455" font-family="monospace" font-size="10" fill="#333">## 展開指示（必ず遵守してください）</text>
  <text x="60" y="470" font-family="monospace" font-size="10" fill="#333">- この章の目的: キャラクターが新たな試練に直面し成長する</text>
  <text x="60" y="485" font-family="monospace" font-size="10" fill="#333">- 達成すべきプロット要素: </text>
  <text x="60" y="500" font-family="monospace" font-size="10" fill="#333">  - 主人公が新たな能力段階に目覚める</text>
  <text x="60" y="515" font-family="monospace" font-size="10" fill="#333">  - 敵組織からの襲撃</text>
  
  <text x="400" y="320" font-family="monospace" font-size="10" fill="#333">## キャラクターの心理状態</text>
  <text x="400" y="335" font-family="monospace" font-size="10" fill="#333">【山田太郎】の心理:</text>
  <text x="400" y="350" font-family="monospace" font-size="10" fill="#333">- 現在の欲求: 強くなりたい、仲間を守りたい</text>
  <text x="400" y="365" font-family="monospace" font-size="10" fill="#333">- 現在の恐れ: 能力を制御できなくなること</text>
  <text x="400" y="380" font-family="monospace" font-size="10" fill="#333">- 感情状態: 決意(8/10)、不安(4/10)</text>
  
  <text x="400" y="395" font-family="monospace" font-size="10" fill="#333">## 文体ガイダンス</text>
  <text x="400" y="410" font-family="monospace" font-size="10" fill="#333">- 同じキャラクター名を連続して主語に使うのを避けてください</text>
  <text x="400" y="425" font-family="monospace" font-size="10" fill="#333">- 代名詞や主語の省略を活用してください</text>
  
  <text x="400" y="440" font-family="monospace" font-size="10" fill="#333">## テンション構築の詳細ガイダンス</text>
  <text x="400" y="455" font-family="monospace" font-size="10" fill="#333">このチャプターでは **テンションを上昇させる** ことを重視してください。</text>
  <text x="400" y="470" font-family="monospace" font-size="10" fill="#333">理由: 敵との対決シーンに向けて緊張感を高める</text>
  
  <text x="400" y="500" font-family="monospace" font-size="10" fill="#333">【出力形式】</text>
  <text x="400" y="515" font-family="monospace" font-size="10" fill="#333">以下の形式で出力してください:</text>
  <text x="400" y="530" font-family="monospace" font-size="10" fill="#333">...</text>
  
  <!-- フローの注釈 -->
  <text x="400" y="570" text-anchor="middle" font-family="Arial" font-size="12" font-style="italic" fill="#666">CoreGenerationEngine → generateContext → generatePrompt → GeminiClient</text>
</svg>
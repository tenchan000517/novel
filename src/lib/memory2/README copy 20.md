# ğŸ“Š è¨˜æ†¶éšå±¤ã‚·ã‚¹ãƒ†ãƒ  ä¿å­˜è¦ä»¶ç¾çŠ¶åˆ†æ

## ğŸ” èª¿æŸ»å¯¾è±¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆ2ã¤ç›®ä»¥é™ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰

---

### 2. CharacterTracker (character-tracker.ts)

#### ğŸ“‹ ä¿å­˜ã—ãŸã„ãƒ‡ãƒ¼ã‚¿
- **ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç™»å ´è¨˜éŒ²**: `{ characterId, characterName, chapterNumber, significance }`
- **ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æˆé•·çµæœ**: é©ç”¨ãƒ•ã‚§ãƒ¼ã‚ºã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿å¤‰æ›´ã€ç¿’å¾—ã‚¹ã‚­ãƒ«
- **ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å¤‰åŒ–æƒ…å ±**: `CharacterDiff`å½¢å¼ã®å¤‰åŒ–ãƒ‡ãƒ¼ã‚¿
- **ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ¡ãƒ¢ãƒª**: `{ characterId, characterName, content, type, chapterNumber, importance }`

#### ğŸ“ ç¾åœ¨ã®ä¿å­˜å…ˆ
```typescript
// EventRegistryã‚’é€šã˜ã¦SignificantEventã¨ã—ã¦è¨˜éŒ²
await this.eventRegistry.recordSignificantEvent({
    id: `appearance-${characterId}-ch${chapterNumber}-${Date.now()}`,
    chapterNumber: chapterNumber,
    description: `${characterName}ãŒç« ${chapterNumber}ã«ç™»å ´`,
    // ...
});

// CharacterManagerã«å‡¦ç†ã‚’å§”è­²
await this.characterManager.processCharacterChanges(characterDiff, chapterNumber);

// å„ãƒ¡ãƒ¢ãƒªãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã‚‚å¤‰åŒ–ã‚’åæ˜ 
await this.worldKnowledge.refreshCharacterData(characterDiff.id);
await this.immediateContext.updateCharacterState(chapter, characterName, changes);
```

#### ğŸ¯ ä¿å­˜é »åº¦ãƒ»ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³
- **ä¿å­˜**: ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç™»å ´æ™‚ã€æˆé•·å‡¦ç†æ™‚ã€ç« ç”Ÿæˆå¾Œ
- **ã‚¢ã‚¯ã‚»ã‚¹**: æ­»äº¡ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãƒ»çµå©šãƒšã‚¢å–å¾—æ™‚
- **é »åº¦**: ç« ç”Ÿæˆã®ãŸã³ã«é«˜é »åº¦ã‚¢ã‚¯ã‚»ã‚¹

#### â“ ç†æƒ³çš„ãªä¿å­˜å…ˆ
- **ç™»å ´è¨˜éŒ²**: ä¸­æœŸè¨˜æ†¶ï¼ˆç« ãƒ¬ãƒ™ãƒ«ã®æ´»å‹•è¨˜éŒ²ï¼‰
- **æˆé•·çµæœ**: é•·æœŸè¨˜æ†¶ï¼ˆæ°¸ç¶šçš„ãªã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å¤‰åŒ–ï¼‰
- **ä¸€æ™‚çš„å¤‰åŒ–**: çŸ­æœŸè¨˜æ†¶ï¼ˆé€²è¡Œä¸­ã®çŠ¶æ…‹å¤‰åŒ–ï¼‰

---

### 3. PersistentEventHandler (persistent-event-handler.ts)

#### ğŸ“‹ ä¿å­˜ã—ãŸã„ãƒ‡ãƒ¼ã‚¿
- **æ°¸ç¶šçš„ã‚¤ãƒ™ãƒ³ãƒˆ**: æ­»äº¡ã€çµå©šã€å‡ºç”£ã€ã‚¹ã‚­ãƒ«ç¿’å¾—ã€ç§»ä½ã€æ˜‡é€²ã€è² å‚·ã€å¤‰èº«
- **ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼çŠ¶æ…‹å¤‰æ›´**: 
  - æ­»äº¡çŠ¶æ…‹: `{ isActive: false, isDeceased: true }`
  - çµå©šçŠ¶æ…‹: `{ maritalStatus: 'MARRIED', spouseId }`
  - è¦ªå­é–¢ä¿‚: `{ parentIds: [], childrenIds: [] }`
  - ã‚¹ã‚­ãƒ«: `{ skills: [...existingSkills, newSkill] }`
  - å±…ä½åœ°: `{ location: newLocation }`

#### ğŸ“ ç¾åœ¨ã®ä¿å­˜å…ˆ
```typescript
// 1. EventRegistryã«åŸºæœ¬ã‚¤ãƒ™ãƒ³ãƒˆã¨ã—ã¦è¨˜éŒ²
await this.eventRegistry.recordSignificantEvent(event);

// 2. é–¢é€£ã™ã‚‹ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®çŠ¶æ…‹æ›´æ–°
await this.characterManager.updateCharacter(character.id, updateData);

// 3. ä¸–ç•ŒçŸ¥è­˜ã«æ°¸ç¶šçš„äº‹å®Ÿã¨ã—ã¦è¨˜éŒ²
await this.worldKnowledge.establishPersistentFact(
    event.id, event.involvedCharacters[0], event.type, 
    event.chapterNumber, event.description, event.location
);
```

#### ğŸ¯ ä¿å­˜é »åº¦ãƒ»ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³
- **ä¿å­˜**: æ°¸ç¶šçš„ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿæ™‚ã®ã¿
- **ã‚¢ã‚¯ã‚»ã‚¹**: ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼çŠ¶æ…‹ç¢ºèªæ™‚
- **é »åº¦**: ä½é »åº¦ä¿å­˜ã€ä¸­é »åº¦ã‚¢ã‚¯ã‚»ã‚¹

#### â“ ç†æƒ³çš„ãªä¿å­˜å…ˆ
- **æ°¸ç¶šçš„ã‚¤ãƒ™ãƒ³ãƒˆ**: é•·æœŸè¨˜æ†¶ âœ… (é©åˆ‡)
- **ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼çŠ¶æ…‹å¤‰æ›´**: é•·æœŸè¨˜æ†¶ âœ… (é©åˆ‡)

---

### 4. ContextGenerator (context-generator.ts)

#### ğŸ“‹ ä¿å­˜ã—ãŸã„ãƒ‡ãƒ¼ã‚¿
- **çµ±åˆè¨˜æ†¶ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ**: ç« ç”Ÿæˆç”¨ã®çµ±åˆæƒ…å ±
- **æœ€è¿‘ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ãƒ¡ãƒ¢ãƒª**: `ChapterMemory[]`
- **ç¾åœ¨ã®ã‚¢ãƒ¼ã‚¯æƒ…å ±**: `ArcMemory`
- **é‡è¦ã‚¤ãƒ™ãƒ³ãƒˆ**: `KeyEvent[]`
- **ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã•ã‚ŒãŸä¼ç·š**: relevanceä»˜ãä¼ç·š
- **é–¢é€£ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼**: relevantCharacterIds
- **é–¢ä¿‚ãƒãƒƒãƒ—**: ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼é–“é–¢ä¿‚æ€§

#### ğŸ“ ç¾åœ¨ã®ä¿å­˜å…ˆ
```typescript
// âŒ ãƒ‡ãƒ¼ã‚¿è‡ªä½“ã¯ä¿å­˜ã›ãšã€å‹•çš„ã«ç”Ÿæˆã—ã¦è¿”ã™ã®ã¿
return {
    chapterNumber: safeChapterNumber,
    narrativeState,
    arc: midTermData,
    recentChapters: shortTermData,
    worldMemory,
    keyEvents,
    foreshadowing: relevantForeshadowing,
    characters: characterDetails,
    relationships,
    significantEvents
};
```

#### ğŸ¯ ä¿å­˜é »åº¦ãƒ»ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³
- **ä¿å­˜**: ãªã—ï¼ˆâŒ å•é¡Œï¼‰
- **ã‚¢ã‚¯ã‚»ã‚¹**: ç« ç”Ÿæˆæ™‚ã«æ¯å›ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆ
- **é »åº¦**: æ¥µã‚ã¦é«˜é »åº¦ç”Ÿæˆã€ãƒ‡ãƒ¼ã‚¿å†åˆ©ç”¨ãªã—

#### â“ ç†æƒ³çš„ãªä¿å­˜å…ˆ
- **çµ±åˆã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ**: çŸ­æœŸè¨˜æ†¶ï¼ˆä¸€æ™‚çš„ç”Ÿæˆçµæœï¼‰
- **ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°çµæœ**: çŸ­æœŸè¨˜æ†¶ï¼ˆè¨ˆç®—æ¸ˆã¿çµæœï¼‰
- **é–¢ä¿‚ãƒãƒƒãƒ—**: ä¸­æœŸè¨˜æ†¶ï¼ˆåˆ†æçµæœï¼‰

#### âš ï¸ å•é¡Œç‚¹
- åŒã˜ç« ã«å¯¾ã—ã¦é‡è¤‡è¨ˆç®—ãŒç™ºç”Ÿ
- é«˜ã‚³ã‚¹ãƒˆãªçµ±åˆå‡¦ç†ã®çµæœãŒå†åˆ©ç”¨ã•ã‚Œãªã„

---

### 5. GenerationContextValidator (generation-context-validator.ts)

#### ğŸ“‹ ä¿å­˜ã—ãŸã„ãƒ‡ãƒ¼ã‚¿
- **æ•´åˆæ€§æ¤œè¨¼çµæœ**: `{ consistent: boolean, issues: string[] }`
- **ä¿®æ­£ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ**: `Partial<GenerationContext>`
- **æ¤œè¨¼å±¥æ­´**: æ¤œè¨¼å®Ÿè¡Œè¨˜éŒ²

#### ğŸ“ ç¾åœ¨ã®ä¿å­˜å…ˆ
```typescript
// âŒ ãƒ‡ãƒ¼ã‚¿ä¿å­˜ã¯è¡Œã‚ãšã€æ¤œè¨¼ãƒ»ä¿®æ­£çµæœã‚’è¿”ã™ã®ã¿
return {
    consistent: issues.length === 0,
    issues
};

return corrections; // ä¿®æ­£ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ
```

#### ğŸ¯ ä¿å­˜é »åº¦ãƒ»ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³
- **ä¿å­˜**: ãªã—ï¼ˆå•é¡Œã®å¯èƒ½æ€§ï¼‰
- **ã‚¢ã‚¯ã‚»ã‚¹**: ç« ç”Ÿæˆå‰ã®æ¤œè¨¼æ™‚ã®ã¿
- **é »åº¦**: ç« ç”Ÿæˆã®ãŸã³ã«å®Ÿè¡Œ

#### â“ ç†æƒ³çš„ãªä¿å­˜å…ˆ
- **æ¤œè¨¼çµæœ**: çŸ­æœŸè¨˜æ†¶ï¼ˆãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰
- **ä¿®æ­£å±¥æ­´**: çŸ­æœŸè¨˜æ†¶ï¼ˆå“è³ªå‘ä¸Šç”¨ï¼‰

#### âš ï¸ å•é¡Œç‚¹
- æ¤œè¨¼å•é¡Œã®å‚¾å‘åˆ†æãŒã§ããªã„
- ä¿®æ­£ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å­¦ç¿’ãŒã§ããªã„

---

### 6. EmotionalArcDesigner (emotional-arc-designer.ts)

#### ğŸ“‹ ä¿å­˜ã—ãŸã„ãƒ‡ãƒ¼ã‚¿
- **ç« ã®æ„Ÿæƒ…åˆ†æçµæœ**: `ChapterEmotionAnalysis`
  - æ„Ÿæƒ…æ¬¡å…ƒã®å¤‰ç§»: `{ start, middle, end }`
  - å…¨ä½“çš„ãªæ„Ÿæƒ…ãƒˆãƒ¼ãƒ³
  - æ„Ÿæƒ…çš„å½±éŸ¿åŠ›ã‚¹ã‚³ã‚¢
- **æ„Ÿæƒ…ã‚¢ãƒ¼ã‚¯è¨­è¨ˆ**: `EmotionalArcDesign`
  - æ¨å¥¨ãƒˆãƒ¼ãƒ³
  - æ„Ÿæƒ…ã®æ—…ï¼ˆopening, development, conclusionï¼‰
  - è¨­è¨ˆç†ç”±

#### ğŸ“ ç¾åœ¨ã®ä¿å­˜å…ˆ
```typescript
// âŒ ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã›ãšã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã«AIåˆ†æã‚’å®Ÿè¡Œã—ã¦çµæœã‚’è¿”ã™ã®ã¿
const analysis = JsonParser.parseFromAIResponse(response, defaultAnalysis);
return analysis; // å‘¼ã³å‡ºã—å…ƒã§ã®ä¿å­˜ãŒå¿…è¦
```

#### ğŸ¯ ä¿å­˜é »åº¦ãƒ»ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³
- **ä¿å­˜**: ãªã—ï¼ˆâŒ å•é¡Œï¼‰
- **ã‚¢ã‚¯ã‚»ã‚¹**: ç« ç”Ÿæˆæ™‚ã«æ¯å›AIåˆ†æå®Ÿè¡Œ
- **é »åº¦**: é«˜é »åº¦ã€é«˜ã‚³ã‚¹ãƒˆï¼ˆAIå‘¼ã³å‡ºã—ï¼‰

#### â“ ç†æƒ³çš„ãªä¿å­˜å…ˆ
- **æ„Ÿæƒ…åˆ†æçµæœ**: ä¸­æœŸè¨˜æ†¶ï¼ˆç« ãƒ¬ãƒ™ãƒ«åˆ†æï¼‰
- **æ„Ÿæƒ…ã‚¢ãƒ¼ã‚¯è¨­è¨ˆ**: ä¸­æœŸè¨˜æ†¶ï¼ˆè¨­è¨ˆçµæœï¼‰
- **AIåˆ†æã‚­ãƒ£ãƒƒã‚·ãƒ¥**: çŸ­æœŸè¨˜æ†¶ï¼ˆé‡è¤‡é˜²æ­¢ï¼‰

#### âš ï¸ å•é¡Œç‚¹
- åŒã˜ç« ã«å¯¾ã™ã‚‹é‡è¤‡AIåˆ†æ
- é«˜ã‚³ã‚¹ãƒˆãªåˆ†æçµæœãŒå†åˆ©ç”¨ã•ã‚Œãªã„
- æ„Ÿæƒ…ãƒ‘ã‚¿ãƒ¼ãƒ³ã®å­¦ç¿’ãŒã§ããªã„

---

### 7. EventMemory (event-memory.ts)

#### ğŸ“‹ ä¿å­˜ã—ãŸã„ãƒ‡ãƒ¼ã‚¿
- **SignificantEvent**: é‡è¦ã‚¤ãƒ™ãƒ³ãƒˆã®å®Œå…¨ãƒ‡ãƒ¼ã‚¿
- **ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æƒ…å ±**: 
  - locationIndex: å ´æ‰€åˆ¥ã‚¤ãƒ™ãƒ³ãƒˆ
  - characterIndex: ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼åˆ¥ã‚¤ãƒ™ãƒ³ãƒˆ
  - typeIndex: ã‚¿ã‚¤ãƒ—åˆ¥ã‚¤ãƒ™ãƒ³ãƒˆ
- **ã‚¤ãƒ™ãƒ³ãƒˆçµ±è¨ˆ**: çµ±è¨ˆæƒ…å ±

#### ğŸ“ ç¾åœ¨ã®ä¿å­˜å…ˆ
```typescript
// ãƒ•ã‚¡ã‚¤ãƒ«æ°¸ç¶šåŒ–
await storageProvider.writeFile(
    'memory/significant-events.json',
    JSON.stringify(eventsArray, null, 2)
);

// ãƒ¡ãƒ¢ãƒªå†…ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
private events: Map<string, SignificantEvent> = new Map();
private locationIndex: Map<string, SignificantEvent[]> = new Map();
private characterIndex: Map<string, SignificantEvent[]> = new Map();
private typeIndex: Map<string, SignificantEvent[]> = new Map();
```

#### ğŸ¯ ä¿å­˜é »åº¦ãƒ»ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³
- **ä¿å­˜**: ã‚¤ãƒ™ãƒ³ãƒˆè¨˜éŒ²æ™‚ã«å³åº§ã«æ°¸ç¶šåŒ–
- **ã‚¢ã‚¯ã‚»ã‚¹**: ã‚¤ãƒ™ãƒ³ãƒˆæ¤œç´¢æ™‚ã«é«˜é »åº¦ã‚¢ã‚¯ã‚»ã‚¹
- **é »åº¦**: é«˜é »åº¦æ›¸ãè¾¼ã¿ãƒ»èª­ã¿å–ã‚Š

#### â“ ç†æƒ³çš„ãªä¿å­˜å…ˆ
- **ã‚¤ãƒ™ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿**: ä¸­æœŸè¨˜æ†¶ âœ… (é©åˆ‡)
- **ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**: çŸ­æœŸè¨˜æ†¶ï¼ˆé«˜é€Ÿã‚¢ã‚¯ã‚»ã‚¹ç”¨ï¼‰
- **çµ±è¨ˆæƒ…å ±**: é•·æœŸè¨˜æ†¶ï¼ˆåˆ†æç”¨ï¼‰

---

### 8. ImmediateContext (immediate-context.ts)

#### ğŸ“‹ ä¿å­˜ã—ãŸã„ãƒ‡ãƒ¼ã‚¿
- **æœ€è¿‘ã®ç« æƒ…å ±**: æœ€å¤§3ç« ã®ç”Ÿãƒ‡ãƒ¼ã‚¿
- **ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼çŠ¶æ…‹**: `Map<string, CharacterState>`
- **ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ã‚º**: æ­£è¦è¡¨ç¾æŠ½å‡ºçµæœ
- **ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—**: ç« è¿½åŠ æ™‚é–“
- **è©³ç´°ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼çŠ¶æ…‹**: ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä»˜ãçŠ¶æ…‹æƒ…å ±

#### ğŸ“ ç¾åœ¨ã®ä¿å­˜å…ˆ
```typescript
// å„ç« ã‚’å€‹åˆ¥ã«ä¿å­˜
await this.writeToStorage(
    `chapters/chapter_${chapterNumber}.json`,
    JSON.stringify(item.chapter)
);

// ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
await this.writeToStorage(
    'immediate-context/metadata.json',
    JSON.stringify(metadata)
);

// ãƒ¡ãƒ¢ãƒªå†…ã‚­ãƒ£ãƒƒã‚·ãƒ¥
private chapterCache: Map<number, Chapter> = new Map();
private characterStateWithMetadata: Map<number, any[]> = new Map();
```

#### ğŸ¯ ä¿å­˜é »åº¦ãƒ»ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³
- **ä¿å­˜**: ç« è¿½åŠ æ™‚ã€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼çŠ¶æ…‹æ›´æ–°æ™‚
- **ã‚¢ã‚¯ã‚»ã‚¹**: æœ€æ–°ç« ãƒ»æœ€è¿‘ã®ç« å–å¾—æ™‚ã«é«˜é »åº¦
- **é »åº¦**: æ¥µã‚ã¦é«˜é »åº¦ã§ã®ã‚¢ã‚¯ã‚»ã‚¹

#### â“ ç†æƒ³çš„ãªä¿å­˜å…ˆ
- **ç« ç”Ÿãƒ‡ãƒ¼ã‚¿**: çŸ­æœŸè¨˜æ†¶ âœ… (é©åˆ‡)
- **ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼çŠ¶æ…‹**: çŸ­æœŸè¨˜æ†¶ âœ… (é©åˆ‡)
- **ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ã‚º**: çŸ­æœŸè¨˜æ†¶ âœ… (é©åˆ‡)

---

### 9. MemoryManager (memory-manager.ts)

#### ğŸ“‹ ä¿å­˜ã—ãŸã„ãƒ‡ãƒ¼ã‚¿
- **çµ±åˆçš„ãªè¨˜æ†¶ç®¡ç†**: ãƒ•ã‚¡ã‚¶ãƒ¼ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã®å§”è­²
- **åˆæœŸåŒ–çŠ¶æ…‹**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆçŠ¶æ…‹ç®¡ç†
- **ã‚¸ãƒ£ãƒ³ãƒ«æƒ…å ±**: å…¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¸ã®ä¼æ’­

#### ğŸ“ ç¾åœ¨ã®ä¿å­˜å…ˆ
```typescript
// âŒ è‡ªèº«ã§ã¯ç›´æ¥çš„ãªä¿å­˜ã‚’è¡Œã‚ãšã€å„è¨˜æ†¶å±¤ã«å§”è­²
if (this.narrativeMemory) {
    await this.narrativeMemory.updateNarrativeState(chapter);
}

// çµ±åˆä¿å­˜å‡¦ç†
const saveResult = await this.saveAllMemories();
```

#### ğŸ¯ ä¿å­˜é »åº¦ãƒ»ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³
- **ä¿å­˜**: å„è¨˜æ†¶å±¤ã¸ã®å§”è­²ã«ã‚ˆã‚Šé–“æ¥çš„ã«ä¿å­˜
- **ã‚¢ã‚¯ã‚»ã‚¹**: é«˜é »åº¦ã§ã®ãƒ•ã‚¡ã‚¶ãƒ¼ãƒ‰ã‚¢ã‚¯ã‚»ã‚¹
- **é »åº¦**: ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®ä¸­æ ¸ã¨ã—ã¦å¸¸æ™‚ã‚¢ã‚¯ã‚»ã‚¹

#### â“ ç†æƒ³çš„ãªä¿å­˜å…ˆ
- **ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹**: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆæ°¸ç¶šåŒ–ï¼‰
- **çµ±åˆãƒ­ã‚°**: çŸ­æœŸè¨˜æ†¶ï¼ˆç›£è¦–ãƒ»ãƒ‡ãƒãƒƒã‚°ç”¨ï¼‰

---

### 10. WorldKnowledge (world-knowledge.ts)

#### ğŸ“‹ ä¿å­˜ã—ãŸã„ãƒ‡ãƒ¼ã‚¿
- **ä¸–ç•Œè¨­å®š**: `WorldSettings`ï¼ˆèª¬æ˜ã€åœ°åŸŸã€æ­´å²ã€ãƒ«ãƒ¼ãƒ«ã€ã‚¸ãƒ£ãƒ³ãƒ«ï¼‰
- **ç¢ºç«‹ã•ã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆ**: `Map<number, EstablishedEvent[]>`
- **ä¼ç·šè¦ç´ **: `Foreshadowing[]`
- **æœ€çµ‚å¤‰æ›´ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—**: å¤‰æ›´è¿½è·¡

#### ğŸ“ ç¾åœ¨ã®ä¿å­˜å…ˆ
```typescript
// ãƒ¡ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«
await this.writeToStorage(
    'world-knowledge/current.json',
    JSON.stringify(currentData, null, 2)
);

// ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
private worldSettings: WorldSettings;
private establishedEvents: Map<number, EstablishedEvent[]> = new Map();
private foreshadowElements: Foreshadowing[] = [];
```

#### ğŸ¯ ä¿å­˜é »åº¦ãƒ»ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³
- **ä¿å­˜**: ä¸–ç•Œè¨­å®šæ›´æ–°æ™‚ã€ã‚¤ãƒ™ãƒ³ãƒˆç¢ºç«‹æ™‚ã€ä¼ç·šè¿½åŠ ãƒ»è§£æ±ºæ™‚
- **ã‚¢ã‚¯ã‚»ã‚¹**: ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆæ™‚ã«é«˜é »åº¦
- **é »åº¦**: ä¸­é »åº¦ä¿å­˜ã€é«˜é »åº¦èª­ã¿å–ã‚Š

#### â“ ç†æƒ³çš„ãªä¿å­˜å…ˆ
- **ä¸–ç•Œè¨­å®š**: é•·æœŸè¨˜æ†¶ âœ… (é©åˆ‡)
- **ç¢ºç«‹ã‚¤ãƒ™ãƒ³ãƒˆ**: é•·æœŸè¨˜æ†¶ âœ… (é©åˆ‡)
- **æœªè§£æ±ºä¼ç·š**: é•·æœŸè¨˜æ†¶ âœ… (é©åˆ‡)
- **è§£æ±ºæ¸ˆã¿ä¼ç·š**: ä¸­æœŸè¨˜æ†¶ï¼ˆã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ï¼‰

---

### 11. TextAnalyzerService (text-analyzer-service.ts)

#### ğŸ“‹ ä¿å­˜ã—ãŸã„ãƒ‡ãƒ¼ã‚¿
- **ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼çŠ¶æ…‹åˆ†æçµæœ**: `CharacterState[]`ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- **åˆ†æã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚­ãƒ¼**: ãƒ†ã‚­ã‚¹ãƒˆãƒãƒƒã‚·ãƒ¥ + ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼å

#### ğŸ“ ç¾åœ¨ã®ä¿å­˜å…ˆ
```typescript
// âŒ ãƒ¡ãƒ¢ãƒªå†…ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ã¿ï¼ˆæ®ç™ºæ€§ï¼‰
private characterStateCache = new Map<string, CharacterState[]>();
```

#### ğŸ¯ ä¿å­˜é »åº¦ãƒ»ã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³
- **ä¿å­˜**: åˆ†ææ™‚ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä¿å­˜
- **ã‚¢ã‚¯ã‚»ã‚¹**: åŒã˜åˆ†æè¦æ±‚æ™‚ã«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰é«˜é€Ÿå–å¾—
- **é »åº¦**: ä¸­é »åº¦ã€AIåˆ†æå›é¿ã«ã‚ˆã‚‹ã‚³ã‚¹ãƒˆå‰Šæ¸›

#### â“ ç†æƒ³çš„ãªä¿å­˜å…ˆ
- **åˆ†æã‚­ãƒ£ãƒƒã‚·ãƒ¥**: çŸ­æœŸè¨˜æ†¶ï¼ˆæ®ç™ºæ€§å›é¿ï¼‰
- **åˆ†æçµ±è¨ˆ**: ä¸­æœŸè¨˜æ†¶ï¼ˆå“è³ªå‘ä¸Šç”¨ï¼‰

#### âš ï¸ å•é¡Œç‚¹
- ãƒ¡ãƒ¢ãƒªå†èµ·å‹•ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒå¤±ã‚ã‚Œã‚‹
- AIåˆ†æçµæœã®è“„ç©ãŒã§ããªã„

---

## ğŸ” é‡è¤‡ãƒ»éåŠ¹ç‡ç®‡æ‰€ã®ç‰¹å®š

### 1. **ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼çŠ¶æ…‹æ›´æ–°ã®é‡è¤‡**
```typescript
// CharacterTracker
await this.characterManager.processCharacterChanges(characterDiff, chapterNumber);
await this.worldKnowledge.refreshCharacterData(characterDiff.id);
await this.immediateContext.updateCharacterState(chapter, characterName, changes);

// PersistentEventHandler
await this.characterManager.updateCharacter(character.id, updateData);
```
**å•é¡Œ**: åŒã˜ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼æ›´æ–°ãŒè¤‡æ•°ç®‡æ‰€ã§ç™ºç”Ÿã€æ•´åˆæ€§ãƒªã‚¹ã‚¯

### 2. **é‡è¤‡ã™ã‚‹çµ±åˆå‡¦ç†**
```typescript
// ContextGeneratorï¼ˆæ¯å›å®Ÿè¡Œï¼‰
const integratedContext = await this.generateIntegratedContext(chapterNumber);

// EmotionalArcDesignerï¼ˆæ¯å›AIåˆ†æï¼‰
const analysis = await this.analyzeChapterEmotion(content, options);
```
**å•é¡Œ**: é«˜ã‚³ã‚¹ãƒˆãªå‡¦ç†ã®çµæœãŒå†åˆ©ç”¨ã•ã‚Œãªã„

### 3. **ä¿å­˜å‡¦ç†ã®åˆ†æ•£**
```typescript
// EventMemory
await storageProvider.writeFile('memory/significant-events.json', data);

// ImmediateContext  
await this.writeToStorage('immediate-context/metadata.json', metadata);

// WorldKnowledge
await this.writeToStorage('world-knowledge/current.json', currentData);
```
**å•é¢˜**: ä¿å­˜ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®ä¸æ•´åˆã€ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³æ€§ã®æ¬ å¦‚

### 4. **ä¸€æ™‚ãƒ‡ãƒ¼ã‚¿ã®æ®ç™ºæ€§**
```typescript
// TextAnalyzerServiceï¼ˆãƒ¡ãƒ¢ãƒªã®ã¿ï¼‰
private characterStateCache = new Map<string, CharacterState[]>();

// ContextGeneratorï¼ˆä¿å­˜ãªã—ï¼‰
return integratedContext; // è¨ˆç®—çµæœãŒå¤±ã‚ã‚Œã‚‹

// GenerationContextValidatorï¼ˆä¿å­˜ãªã—ï¼‰
return { consistent, issues }; // æ¤œè¨¼å±¥æ­´ãŒå¤±ã‚ã‚Œã‚‹
```
**å•é¡Œ**: é«˜ã‚³ã‚¹ãƒˆå‡¦ç†ã®çµæœãŒå†åˆ©ç”¨ã§ããªã„

---

## ğŸ“Š ä¿å­˜å…ˆåˆ¥ãƒ‡ãƒ¼ã‚¿åˆ†é¡

### ğŸ”´ é•·æœŸè¨˜æ†¶ï¼ˆWorldKnowledgeï¼‰- è¨­å®šãƒ»æ°¸ç¶šäº‹å®Ÿ
- âœ… WorldSettingsï¼ˆä¸–ç•Œè¨­å®šï¼‰
- âœ… EstablishedEventï¼ˆç¢ºç«‹ã‚¤ãƒ™ãƒ³ãƒˆï¼‰
- âœ… Foreshadowingï¼ˆä¼ç·šï¼‰
- âœ… PersistentEventï¼ˆæ°¸ç¶šçš„ã‚¤ãƒ™ãƒ³ãƒˆï¼‰

### ğŸŸ¡ ä¸­æœŸè¨˜æ†¶ï¼ˆNarrativeMemory + EventMemoryï¼‰- é€²è¡Œãƒ»åˆ†æçµæœ
- âœ… SignificantEventï¼ˆé‡è¦ã‚¤ãƒ™ãƒ³ãƒˆï¼‰
- â“ ChapterEmotionAnalysisï¼ˆæ„Ÿæƒ…åˆ†æçµæœï¼‰
- â“ EmotionalArcDesignï¼ˆæ„Ÿæƒ…ã‚¢ãƒ¼ã‚¯è¨­è¨ˆï¼‰
- â“ IntegratedContextï¼ˆçµ±åˆã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼‰

### ğŸŸ¢ çŸ­æœŸè¨˜æ†¶ï¼ˆImmediateContextï¼‰- ç”Ÿãƒ‡ãƒ¼ã‚¿ãƒ»ä¸€æ™‚æƒ…å ±
- âœ… Chapterç”Ÿãƒ‡ãƒ¼ã‚¿ï¼ˆæœ€è¿‘3ç« ï¼‰
- âœ… CharacterStateï¼ˆã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼çŠ¶æ…‹ï¼‰
- âœ… KeyPhrasesï¼ˆã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ã‚ºï¼‰
- â“ AnalysisCacheï¼ˆåˆ†æã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰
- â“ ValidationResultsï¼ˆæ¤œè¨¼çµæœï¼‰

---

## ğŸ¯ æœ€ã‚‚æ”¹å–„ãŒå¿…è¦ãªç®‡æ‰€

### 1. **ContextGenerator**
- é«˜ã‚³ã‚¹ãƒˆãªçµ±åˆå‡¦ç†ã®çµæœãŒä¿å­˜ã•ã‚Œãªã„
- æ¯å›åŒã˜è¨ˆç®—ã‚’é‡è¤‡å®Ÿè¡Œ

### 2. **EmotionalArcDesigner**
- AIåˆ†æçµæœãŒä¿å­˜ã•ã‚Œãªã„
- åŒã˜ç« ã¸ã®é‡è¤‡AIå‘¼ã³å‡ºã—

### 3. **TextAnalyzerService**
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæ®ç™ºæ€§ã®ã¿
- åˆ†æçµæœã®è“„ç©ãŒã§ããªã„

### 4. **ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼çŠ¶æ…‹ç®¡ç†**
- è¤‡æ•°ç®‡æ‰€ã§ã®é‡è¤‡æ›´æ–°
- æ•´åˆæ€§ç®¡ç†ã®è¤‡é›‘åŒ–

### 5. **ä¿å­˜å‡¦ç†ã®çµ±åˆæ€§**
- åˆ†æ•£ã—ãŸä¿å­˜å‡¦ç†
- ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³æ€§ã®æ¬ å¦‚

---

## ğŸ’¡ åŒ…æ‹¬çš„ä¿å­˜ã‚·ã‚¹ãƒ†ãƒ ã®å¿…è¦æ€§

ç¾çŠ¶åˆ†æã®çµæœã€ä»¥ä¸‹ãŒå¿…è¦ã§ã™:

1. **çµ±åˆã•ã‚ŒãŸä¸€æ™‚ãƒ‡ãƒ¼ã‚¿ç®¡ç†**: é«˜ã‚³ã‚¹ãƒˆå‡¦ç†çµæœã®å†åˆ©ç”¨
2. **ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼çŠ¶æ…‹æ›´æ–°ã®çµ±åˆ**: é‡è¤‡å‡¦ç†ã®æ’é™¤  
3. **ä¿å­˜å‡¦ç†ã®çµ±åˆ**: ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³æ€§ã®ç¢ºä¿
4. **ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚·ã‚¹ãƒ†ãƒ ã®æ°¸ç¶šåŒ–**: æ®ç™ºæ€§å•é¡Œã®è§£æ±º
5. **åˆ†æçµæœã®è“„ç©**: å“è³ªå‘ä¸Šã¨ã‚³ã‚¹ãƒˆå‰Šæ¸›

å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒæ±‚ã‚ã‚‹ä¿å­˜è¦ä»¶ã¯æ˜ç¢ºã§ã™ãŒã€ç¾åœ¨ã®è¨˜æ†¶éšå±¤ã¸ã®ä¿å­˜æ–¹æ³•ãŒåˆ†æ•£ãƒ»é‡è¤‡ãƒ»ä¸€éƒ¨æ¬ å¦‚ã—ã¦ã„ã‚‹çŠ¶æ³ã§ã™ã€‚

å…±æœ‰ã„ãŸã ã„ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª¿æŸ»ã—ã€å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä¿å­˜è¦ä»¶ã‚’ç‰¹å®šã„ãŸã—ã¾ã™ã€‚ç¾çŠ¶æŠŠæ¡ã«é›†ä¸­ã—ã¦åˆ†æã„ãŸã—ã¾ã™ã€‚ç¾çŠ¶åˆ†æãŒå®Œäº†ã„ãŸã—ã¾ã—ãŸã€‚å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä¿å­˜è¦ä»¶ã¨å•é¡Œç‚¹ã‚’åŒ…æ‹¬çš„ã«ç‰¹å®šã„ãŸã—ã¾ã—ãŸã€‚

## ğŸ” é‡è¦ãªç™ºè¦‹

### **æœ€ã‚‚æ”¹å–„ãŒå¿…è¦ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ**

1. **ContextGenerator** - é«˜ã‚³ã‚¹ãƒˆãªçµ±åˆå‡¦ç†ã®çµæœãŒå…¨ãä¿å­˜ã•ã‚Œãªã„
   - æ¯å›åŒã˜è¨ˆç®—ã‚’é‡è¤‡å®Ÿè¡Œ
   - çµ±åˆè¨˜æ†¶ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç”ŸæˆãŒç« ç”Ÿæˆã®ãŸã³ã«ç™ºç”Ÿ

2. **EmotionalArcDesigner** - AIåˆ†æçµæœãŒä¿å­˜ã•ã‚Œãªã„
   - åŒã˜ç« ã«å¯¾ã™ã‚‹é‡è¤‡AIåˆ†æ
   - é«˜ã‚³ã‚¹ãƒˆãªAIå‘¼ã³å‡ºã—ã®çµæœãŒä½¿ã„æ¨ã¦

3. **TextAnalyzerService** - ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæ®ç™ºæ€§ã®ã¿
   - ãƒ¡ãƒ¢ãƒªå†èµ·å‹•ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ¶ˆå¤±
   - åˆ†æçµæœã®è“„ç©ãŒã§ããªã„

### **é‡è¤‡ãƒ»éåŠ¹ç‡ç®‡æ‰€**

```typescript
// ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼çŠ¶æ…‹æ›´æ–°ãŒè¤‡æ•°ç®‡æ‰€ã§ç™ºç”Ÿ
// CharacterTracker
await this.characterManager.processCharacterChanges(characterDiff, chapterNumber);
await this.worldKnowledge.refreshCharacterData(characterDiff.id);
await this.immediateContext.updateCharacterState(chapter, characterName, changes);

// PersistentEventHandler
await this.characterManager.updateCharacter(character.id, updateData);
```

**ç™ºè¦‹å ´æ‰€**: CharacterTrackerã€PersistentEventHandlerã€ImmediateContext

### **ä¿å­˜å…ˆã®åˆ†æ•£ä¾‹**

- EventMemory: `memory/significant-events.json`
- ImmediateContext: `chapters/` + `immediate-context/metadata.json`  
- WorldKnowledge: `world-knowledge/current.json`
- NarrativeMemory: è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆsummaries.json, state.jsonãªã©ï¼‰

## ğŸ¯ å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä¿å­˜è¦ä»¶æ•´ç†

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | ä¿å­˜ã—ãŸã„ãƒ‡ãƒ¼ã‚¿ | ç¾åœ¨ã®ä¿å­˜å…ˆ | å•é¡Œç‚¹ |
|---|---|---|---|
| ContextGenerator | çµ±åˆè¨˜æ†¶ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã€é–¢ä¿‚ãƒãƒƒãƒ— | **ä¿å­˜ãªã—** | **æ¯å›é‡è¤‡è¨ˆç®—** |
| EmotionalArcDesigner | æ„Ÿæƒ…åˆ†æçµæœã€æ„Ÿæƒ…ã‚¢ãƒ¼ã‚¯è¨­è¨ˆ | **ä¿å­˜ãªã—** | **é‡è¤‡AIåˆ†æ** |
| TextAnalyzerService | åˆ†æã‚­ãƒ£ãƒƒã‚·ãƒ¥ | ãƒ¡ãƒ¢ãƒªã®ã¿ | **æ®ç™ºæ€§** |
| CharacterTracker | ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ç™»å ´ãƒ»æˆé•·è¨˜éŒ² | è¤‡æ•°ç®‡æ‰€ã«åˆ†æ•£ | **é‡è¤‡æ›´æ–°** |
| PersistentEventHandler | æ°¸ç¶šçš„ã‚¤ãƒ™ãƒ³ãƒˆã€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼çŠ¶æ…‹ | è¤‡æ•°ç®‡æ‰€ã«åˆ†æ•£ | **é‡è¤‡æ›´æ–°** |
| GenerationContextValidator | æ¤œè¨¼çµæœã€ä¿®æ­£å±¥æ­´ | **ä¿å­˜ãªã—** | **å­¦ç¿’ä¸å¯** |
| EventMemory | é‡è¦ã‚¤ãƒ™ãƒ³ãƒˆã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ | å°‚ç”¨ãƒ•ã‚¡ã‚¤ãƒ« | é©åˆ‡ |
| ImmediateContext | ç« ç”Ÿãƒ‡ãƒ¼ã‚¿ã€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼çŠ¶æ…‹ | å°‚ç”¨ãƒ•ã‚¡ã‚¤ãƒ« | é©åˆ‡ |
| WorldKnowledge | ä¸–ç•Œè¨­å®šã€ç¢ºç«‹ã‚¤ãƒ™ãƒ³ãƒˆã€ä¼ç·š | å°‚ç”¨ãƒ•ã‚¡ã‚¤ãƒ« | é©åˆ‡ |

## ğŸ”„ ç‹¬è‡ªä½œæˆç®‡æ‰€ã§åŒ…æ‹¬çš„ãƒ‡ãƒ¼ã‚¿ã«çµ±åˆã™ã¹ãç®‡æ‰€

### 1. **ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼çŠ¶æ…‹ç®¡ç†ã®çµ±åˆ**
```typescript
// ç¾çŠ¶ï¼šè¤‡æ•°ç®‡æ‰€ã§å€‹åˆ¥ç®¡ç†
CharacterTracker â†’ ç™»å ´è¨˜éŒ²
PersistentEventHandler â†’ æ°¸ç¶šçš„çŠ¶æ…‹å¤‰æ›´
ImmediateContext â†’ ä¸€æ™‚çš„çŠ¶æ…‹

// ææ¡ˆï¼šCharacterManagerã«çµ±åˆ
CharacterManager â†’ å…¨ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼çŠ¶æ…‹ã®çµ±ä¸€ç®¡ç†
```

### 2. **ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†ã®çµ±åˆ**
```typescript
// ç¾çŠ¶ï¼šåˆ†æ•£ç®¡ç†
EventMemory â†’ ã‚¤ãƒ™ãƒ³ãƒˆä¿å­˜
EventRegistry â†’ ã‚¤ãƒ™ãƒ³ãƒˆæ¤œç´¢
PersistentEventHandler â†’ æ°¸ç¶šçš„ã‚¤ãƒ™ãƒ³ãƒˆå‡¦ç†

// ææ¡ˆï¼šçµ±ä¸€ã•ã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ 
UnifiedEventSystem â†’ ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«å…¨ä½“ã‚’ç®¡ç†
```

### 3. **åˆ†æçµæœç®¡ç†ã®çµ±åˆ**
```typescript
// ç¾çŠ¶ï¼šå€‹åˆ¥ç®¡ç†
EmotionalArcDesigner â†’ æ„Ÿæƒ…åˆ†æçµæœ
TextAnalyzerService â†’ ãƒ†ã‚­ã‚¹ãƒˆåˆ†æã‚­ãƒ£ãƒƒã‚·ãƒ¥
ContextGenerator â†’ çµ±åˆã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ

// ææ¡ˆï¼šåˆ†æçµæœã®çµ±åˆç®¡ç†
AnalysisResultManager â†’ å…¨åˆ†æçµæœã®çµ±ä¸€ç®¡ç†ãƒ»å†åˆ©ç”¨
```

### 4. **ä¿å­˜å‡¦ç†ã®çµ±åˆ**
```typescript
// ç¾çŠ¶ï¼šå„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒç‹¬è‡ªå®Ÿè£…
EventMemory â†’ storageProvider.writeFile('memory/significant-events.json')
ImmediateContext â†’ writeToStorage('immediate-context/metadata.json')
WorldKnowledge â†’ writeToStorage('world-knowledge/current.json')

// ææ¡ˆï¼šOptimizedStorageProviderã‚’æ´»ç”¨ã—ãŸçµ±åˆä¿å­˜
UnifiedStorageManager â†’ ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³æ€§ã®ã‚ã‚‹çµ±åˆä¿å­˜
```

## ğŸ“Š ç†æƒ³çš„ãªä¿å­˜å…ˆåˆ†é¡

### ğŸ”´ é•·æœŸè¨˜æ†¶ï¼ˆWorldKnowledgeï¼‰- ç¾çŠ¶é©åˆ‡
- âœ… ä¸–ç•Œè¨­å®šã€ç¢ºç«‹ã‚¤ãƒ™ãƒ³ãƒˆã€ä¼ç·šã€æ°¸ç¶šçš„ã‚¤ãƒ™ãƒ³ãƒˆ

### ğŸŸ¡ ä¸­æœŸè¨˜æ†¶ï¼ˆNarrativeMemory + æ–°è¦ï¼‰- æ‹¡å¼µå¿…è¦
- âœ… é‡è¦ã‚¤ãƒ™ãƒ³ãƒˆ
- â“ **æ„Ÿæƒ…åˆ†æçµæœ**ï¼ˆç¾åœ¨æœªä¿å­˜ï¼‰
- â“ **æ„Ÿæƒ…ã‚¢ãƒ¼ã‚¯è¨­è¨ˆ**ï¼ˆç¾åœ¨æœªä¿å­˜ï¼‰
- â“ **çµ±åˆã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ**ï¼ˆç¾åœ¨æœªä¿å­˜ï¼‰

### ğŸŸ¢ çŸ­æœŸè¨˜æ†¶ï¼ˆImmediateContext + æ–°è¦ï¼‰- æ‹¡å¼µå¿…è¦
- âœ… ç« ç”Ÿãƒ‡ãƒ¼ã‚¿ã€ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼çŠ¶æ…‹ã€ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ã‚º
- â“ **åˆ†æã‚­ãƒ£ãƒƒã‚·ãƒ¥**ï¼ˆç¾åœ¨æ®ç™ºæ€§ï¼‰
- â“ **æ¤œè¨¼çµæœ**ï¼ˆç¾åœ¨æœªä¿å­˜ï¼‰

ã“ã®åˆ†æçµæœã‹ã‚‰ã€**çµ±ä¸€ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ **ã¨**é«˜ã‚³ã‚¹ãƒˆå‡¦ç†çµæœã®å†åˆ©ç”¨æ©Ÿæ§‹**ã®å¿…è¦æ€§ãŒæ˜ç¢ºã«ãªã‚Šã¾ã—ãŸã€‚ç‰¹ã« **ContextGenerator** ã¨ **EmotionalArcDesigner** ã®çµæœä¿å­˜ãŒæœ€å„ªå…ˆèª²é¡Œã§ã™ã€‚